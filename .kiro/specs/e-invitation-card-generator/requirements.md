# Requirements Document

## Introduction

This feature implements an AI-powered e-invitation card generator that takes a generated SVG pattern and creates a complete draft e-invitation card with contextually appropriate placeholder content and color scheme. The system uses a two-phase AI inference approach: first generating the geometric pattern, then generating the card content and styling based on the user's original prompt.

## Glossary

- **Card Generator**: The module responsible for orchestrating the creation of the final e-invitation card SVG
- **Pattern SVG**: The repeating geometric pattern SVG generated by the fractal engine processor
- **Placeholder Content**: AI-generated text elements for the invitation (event title, date, venue, etc.)
- **Color Scheme**: The AI-determined color palette for text, backgrounds, and overlays
- **Content Config**: A structured JSON object containing placeholder text and styling parameters
- **Inference Service**: The service that communicates with the Gemini LLM
- **Draft Card**: The final SVG output combining pattern, content, and styling

## Requirements

### Requirement 1

**User Story:** As a user, I want the system to generate contextually appropriate invitation content based on my original prompt, so that the draft card reflects my event type and style preferences.

#### Acceptance Criteria

1. WHEN the card generator receives a user prompt and pattern SVG, THE Card Generator SHALL invoke the Inference Service to generate a Content Config
2. THE Content Config SHALL include event title, subtitle, date placeholder, time placeholder, venue placeholder, and RSVP text
3. THE Content Config SHALL include a color scheme with at least primary text color, secondary text color, and overlay color with opacity
4. THE Inference Service SHALL use the Gemini 2.0 Flash model with structured output to ensure valid JSON response
5. IF the Inference Service fails to generate valid Content Config, THEN THE Card Generator SHALL use default placeholder values

### Requirement 2

**User Story:** As a user, I want the draft card to combine the geometric pattern with readable invitation text, so that I can see a complete preview of my e-invitation.

#### Acceptance Criteria

1. THE Card Generator SHALL accept the pattern SVG string as input
2. THE Card Generator SHALL overlay text elements on top of the pattern background
3. THE Card Generator SHALL position text elements in a vertically centered layout with appropriate spacing
4. THE Card Generator SHALL apply the AI-generated color scheme to all text and overlay elements
5. THE Card Generator SHALL maintain the card dimensions of 1080x1920 pixels

### Requirement 3

**User Story:** As a developer, I want the card generator to be integrated into the existing pattern generation flow, so that the complete card is generated in a single API call.

#### Acceptance Criteria

1. THE Pattern Service SHALL invoke the card generator after receiving the pattern SVG from the processor
2. THE Card Generator SHALL return a complete SVG string representing the final draft card
3. THE Pattern Service SHALL save the final card SVG to the output directory
4. THE API endpoint SHALL return the complete card SVG in the response payload
5. THE Card Generator SHALL log progress and errors for debugging purposes

### Requirement 4

**User Story:** As a user, I want the system to handle different event types appropriately, so that my wedding invitation looks different from my birthday party invitation.

#### Acceptance Criteria

1. THE Inference Service SHALL analyze the user prompt to determine event type
2. THE Content Config SHALL include event-type-specific placeholder text
3. WHEN the prompt indicates a formal event, THE Content Config SHALL use formal language and elegant styling
4. WHEN the prompt indicates a casual event, THE Content Config SHALL use casual language and playful styling
5. THE Color Scheme SHALL reflect the tone and formality of the detected event type

### Requirement 5

**User Story:** As a developer, I want the card generator to use Pydantic models for data validation, so that the system maintains type safety and clear contracts.

#### Acceptance Criteria

1. THE Card Generator SHALL define a ContentConfig Pydantic model for the AI response schema
2. THE ContentConfig model SHALL include fields for all text elements and color scheme parameters
3. THE Inference Service SHALL validate the AI response against the ContentConfig schema
4. IF validation fails, THEN THE Card Generator SHALL log the validation error and use defaults
5. THE Card Generator SHALL define a CardResponse model for the final output structure
